---
title: 프로토타입 현황 및 계획
date: 2022-05-12
author: ideook
layout: post
---

## 개발 현황

### 면적 집계

- Body Type 전체에서 층별면적 가져오기
- 면적개요 DB 및 집계 1차
- 용도별 면적표 DB 및 집계 1차
- 동/ 층별 면적표 DB 및 집계 1차
- 대지 Face 선택후 면적 가져오기

### 설정

- 프로젝트 조회
- 프로젝트 추가
- 레이어 탬플릿 조회
- 레이어 가져오기
- 면적 집계 대안 저장

### 대안 리포팅

- 대안 정보 DB 저장
- 별도 웹 사이트 개발
- 대안 목록, 용도/동/층별 면적표 조회

## 프로세스 검토

### 프로세스 안

1. 프로젝트생성/ 조회
2. 대지 경계 등록
3. 용도 레이어 등록
4. 매스 모델링/ 수정
5. 규모 및 면적 검토
6. 대안 생성
7. 대안 비교

### 필요 사항

- 프로젝트 생성
- 프로젝트 로드 (파일 다운로드)
- 대지 관리
- 용도별 레벨 관리 (레벨 명칭에 레이어명 표기)
- 편리한 레벨 관리 (용도별 층고 등)
- 주차대수 계산 (용도별 계산 방식)
- 공동주택/오피스텔 세대 타입 관리 (그룹, DB)
- 집계 정보에 따른 알림

## 기능 개발

- 프로젝트 생성 기능
- 프로젝트 로드 기능
- 대지 자동 선택 기능
- 대지면적 계산
- [건축면적 계산](./2022-05-12-건축면적계산.md)
- 용도(레이어)별 레벨 자동 생성
- 동별 레벨 생성 기능
- 용도별 주차대수계산법 DB화
- 주차대수계산 기능
- 세대타입 DB방식 관리 (용도, 면적, 기준점, )

이상 필수기능이다.

- 볼륨자동생성
- 지하주차장 자동 모델링
- 실시간(이벤트기반) 면적 계산
- 집계 및 면적표 개선

여기까지는 부가기능이다.

### 층별 면적표 형식으로 만들어보기

- 그룹핑 기준 찾기
- 버튼 클릭으로 실행하기
- 면적 가져오기
- 계산하기
- LABEL과 VALUE 표현하기

### 주차대수 계산하기

- 그룹핑 기준으로 주차 기준 설정하기
- 그룹핑이 없어지면 주차대수 설정도 없어질텐데..

### 최고높이 계산

- 그룹별 건물 최고높이 보여주기

### 건축면적 계산

- body의 face별로 공간데이터형식을 통한 연산으로 계산
- face normal.z <> 0 인 모든 것 선정
- 공간데이터형식 내장 연산함수 중 union 이용
- 데이터를 저장하지 않고 SQL Server 쿼리만 실행하여 결과값 받음

### 대지 객체 선택 및 면적계산

- 대지 face 자동 선택
- face가 group인지, face인지, loopArray인지 자동으로 판단
- group, face, loopArray여부에 따라 자동 면적 계산
- 대지 face 선택되었다는 setSelection 기능

### 실시간 계산

이벤트 기반으로 전체 재 계산, 이 경우 사용자가 뭔가 설정한 내용이 있다면 조심히 다뤄야 한다. 부분적으론 계속 계산이 이루어져야 한다.

### 용도/ 동별 레벨 자동 생성

레이어, 동별 레벨을 만들어주는 기능이 필요하다. formit의 레벨은 레이어나 body별로 그룹핑을 할수 없기때문에 만약 여러동의 레벨을 따로 관리하고 싶다면 기본기능에서는 전체 목록이 보이기 때문에 그 관리가 너무 어렵다. 레이어와 body별로 레벨을 생성할때 레벨명에 prefix를 붙여 기계적인 식별이 가능하도록 한다. '공동주택'의 레벨을 가져올때는 '공동주택\_1F, 공동주택\_2F..' 들을 가져오도록 한다. 당연하게도 레벨을 생성할때 자동으로 '공동주택' prefix를 붙히게 된다.

- 팝업창 필요
- 레이어 목록 보기
- body 목록 보기
- 시작레벨, 층고, 층수 입력
- 기존레벨 조회, 관리
- 그리드형태의 조회화면
- 레이어, 층명칭, elevation, 층고, 바닥면적 조회

### 지역지구 데이터 가져오기

공공데이터 포털 API로 지역지구 데이터를 가져오자

### 대지 현황정보 데이터 가져오기

공공데이터 포털 API로 대지 현황정보 데이터를 가져오자

[국토교통부\_건축물대장정보 서비스](https://www.data.go.kr/tcs/dss/selectApiDataDetailView.do?publicDataPk%3D15044713)

### 계산식 DB 관리

각종 계산식을 DB에 string 으로 관리해 C# Math Parser 를 통해 계산 결과를 받는 시나리오

```c#
static void Main(string[] args)
{
    string formula = "(a+b)/c"; // Take it from the data base or whatever...
    Console.WriteLine("Enter first number:");
    string a = Console.ReadLine();
    Console.WriteLine("Enter second number:");
    string b = Console.ReadLine();
    Console.WriteLine("Enter third number:");
    string c = Console.ReadLine();

    // Replace all letters with numbers
    formula = formula.Replace("a", a).Replace("b", b).Replace("c", c);

    // Evaluate the formula
    Console.WriteLine("Formula: {0}\tResult: {1}", formula, Evaluate(formula));
    Console.ReadLine();

}

public static double Evaluate(string expression)
{
    DataTable table = new DataTable();
    table.Columns.Add("myExpression", string.Empty.GetType(), expression);
    DataRow row = table.NewRow();
    table.Rows.Add(row);
    return double.Parse((string)row["myExpression"]);
}
```

- Math Parser 방식

### 대지, 배치계획 DWG 가져오기 자동화
DWG 로 작성한 대지경계선과 건축물의 경계선을 가져온 후 대지로 만들고, 건물 body로 올리고 하는 작업을 자동화 해보자. 어떤 부분 자동화 해야할까.
- 대지 경계는 변하지 않음, 한번 가져온 후 그 정보를 DB에 저장함
- 대지 경계 GeometryDB로 저장


